\subsection{Higgs $\rightarrow \tau\tau$ signal}

The matrix element for the signal is given by the expression:
\begin{equation}
w = \frac{1}{\sigma_{acc}} \sum_{a,b} \int dx_{a} dx_{b} \frac{f(x_{a}) f(x_{b})}{x_{a} x_{b} s} \ \delta^2((x_a P_a + x_b P_b) + \sum P_{k}) 
  \vert \mathcal{M} \vert^2 \ W(\vec{y}|\vert\vec{x}) \ d\vec{x} \ \mathcal{R} \ dP_{x}^{recoil} dP_{y}^{recoil} 
\label{eq:meSignal}
\end{equation}
$\sigma_{acc}$ denotes the product of cross--section times acceptance of the analysis for the signal.
The summation $\sum_{a,b}$ extends over gluons plus quark--anti quark pairs.
The symbol $f$ represents the parton distribution functions.
The two--dimensional $\delta$--function imposes conservation of energy and longitudinal momentum between initial and final state.

The phase--space element $d\vec{x}$ represents all particles in the the final state.
The simplest case is the hadronic channel. In this case:
\begin{equation*}
d\vec{x} = \frac{d^3p_{h+}}{(2\pi)^3 2 E_{h+}} \frac{d^3p_{\bar{\nu}}}{(2\pi)^3 2 E_{\bar{\nu}}} \ \frac{d^3p_{h-}}{(2\pi)^3 2 E_{h-}} \frac{d^3p_{\nu}}{(2\pi)^3 2 E_{\nu}},
\end{equation*}
where we by $h+$ ($h-$) the system of hadrons produced in the $\tau^{+}$ ($\tau^{-}$) decay.
We use the recursive relation for phase--space elements given in the kinematics section of the PDG~\cite{PDG} (Eq.{\it 43.12}) to write the phase--space element as:
\begin{eqnarray*}
d\vec{x} & = & (2\pi)^6 \frac{d^3p_{\tau+}}{(2\pi)^3 2 E_{\tau+}} \frac{d^3p_{h+}}{(2\pi)^3 2 E_{h+}} \frac{d^3p_{\bar{\nu}}}{(2\pi)^3 2 E_{\bar{\nu}}}
  \ \delta(E_{\tau+} - E_{h+} - E_{\bar{nu}}) \ \delta^3(\vec{p}_{\tau+} - \vec{p}_{h+} - \vec{p}_{\bar{nu}}) \\
  & & \cdot \frac{d^3p_{\tau+}}{(2\pi)^3 2 E_{\tau+}} \frac{d^3p_{h-}}{(2\pi)^3 2 E_{h-}} \frac{d^3p_{\nu}}{(2\pi)^3 2 E_{\nu}} 
  \ \delta(E_{\tau-} - E_{h-} - E_{\bar{nu}}) \ \delta^3(\vec{p}_{\tau-} - \vec{p}_{h-} - \vec{p}_{\bar{nu}}) dq_{1}^2 dq_{2}^2.   
\end{eqnarray*}
Extending the dimension of the integral may seem like a complication at first, but will simplify the calculus later.

The actual Matrix Element $\vert \mathcal{M} \vert^2$ consists of three parts:
\begin{equation*}
\vert \mathcal{M} \vert^2 = \vert \mathcal{M}_{HS} \vert^2 \cdot \frac{1}{(m_{H}\Gamma_{H})^{2}} \delta(M_{\tau\tau}^2 - m_{H}^2) 
\frac{1}{(m_{\tau}\Gamma_{\tau})^{4}} \delta(q_{1}^2 - m_{\tau}^2) \delta(q_{2}^2 - m_{\tau}^2) \cdot \vert \mathcal{M}_{decay} \vert^2.
\end{equation*}
The first part, $\vert \mathcal{M}_{HS} \vert^2$ denotes the Matrix Element for the ``hard-scatter'' interaction $pp \rightarrow Higgs \rightarrow \tau\tau$, 
which we intend to take from MadGraph~\cite{MadGraph}.
The third part, $\vert \mathcal{M}_{decay} \vert^2$, represents the tau decays.
The second part contains the Breit--Wigner functions of the propagator terms that relate the hard--scatter interaction to the tau decays.

The variables $P_{x}^{recoil}$ and $P_{y}^{recoil}$ represent the hadronic recoil:
\begin{eqnarray*}
P_{x}^{recoil} & = & -\left(\METx + \sum_{e} P_{x}^{e} + \sum_{\mu} P_{x}^{\mu} + \sum_{\tau_{h}} P_{x}^{\tau_{h}} + \sum_{jets} P_{x}^{jet} \right) \\
P_{y}^{recoil} & = & -\left(\METy + \sum_{e} P_{y}^{e} + \sum_{\mu} P_{y}^{\mu} + \sum_{\tau_{h}} P_{y}^{\tau_{h}} + \sum_{jets} P_{y}^{jet} \right) 
\end{eqnarray*}
The issue with the hadronic recoil is that the Matrix Elements generated by MadGraph are leading order.
The system of particles passed to the Matrix Element are expected to be balanced in transvere momentum.
The hadronic recoil spoils this balance, causing the taus produced in the Higgs decay not to be ``back--to--back'' 
and their transverse momenta to extend beyond the kinematic endpoint $P_{T}^{\tau_{h}} = \frac{1}{2} m_{H}$.
We follow Ref.~\cite{Alwall:2010cq} and integrate over the hadronic recoil, using a transfers function $\mathcal{R}$ that constrains the
integration to values compatible with the measured hadronic recoil:
\begin{equation*}
\mathcal{R} = \frac{1}{2\pi \sqrt{\det V}} \exp \left( - \left( \vec{p}^{recoil} - \vec{p}_{exp}^{recoil} \right)^{T} V^{-1} \left( \vec{p}^{recoil} - \vec{p}_{exp}^{recoil} \right) \right),
\end{equation*}
with $\vec{p}_{exp}^{recoil} = -\left( \sum_{taus} \vec{p}_{\tau} \sum_{jets} \vec{p}_{jet} \right)$.
Note that the sum in the expression for $\vec{p}_{exp}^{recoil}$ extend over the ``true'' momenta of the two taus originating from the Higgs decay plus the momenta of high $P_{T}$ jets.

The vector $\vec{p}_{exp}^{recoil}$ can be used to transform the momenta $\vec{p}_{\tau}$ and $\vec{p}_{jet}$ into the {\em zero momentum frame} of the hard-scatter interaction.
The transformation is performed by a Lorentz boost in the transverse plane:
\begin{equation*}
\vec{p}' = \Lambda \vec{p}.
\end{equation*}
The transformation matrix is given by:
\begin{equation*}
\Lambda = \left| \begin{array}{cccc}
 \gamma & -\gamma \beta_{x} & -\gamma \beta_{y} & 0 \\
 -\gamma \beta_{x} & 1 + (\gamma - 1) \frac{\beta_{x}^2}{\beta^2} & (\gamma - 1) \frac{\beta_{x}\beta_{y}}{\beta^2} & 0 \\
 -\gamma \beta_{y} & (\gamma - 1) \frac{\beta_{x}\beta_{y}}{\beta^2} & 1 + (\gamma - 1) \frac{\beta_{y}^2}{\beta^2} & 0 \\
 0 & 0 & 0 & 1 \end{array} \right|,
\end{equation*}
with $\beta_{x} = \frac{P_{x}^{recoil}}{P_{T}^{recoil}}$, $\beta_{y} = \frac{P_{y}^{recoil}}{P_{T}^{recoil}}$,
$P_{T}^{recoil} = \sqrt{{P_{x}^{recoil}}^2 + {P_{y}^{recoil}}^2}$, $\beta = \sqrt{\beta_{x}^2 + \beta_{y}^2}$ and $\gamma = \frac{1}{\sqrt{1 - \beta^2}}$.

\subsubsection{$\vert \mathcal{M}_{HS} \vert^2$}

Christian suggest that we compute $\vert \mathcal{M}_{HS} \vert^2$ separately for Higgs $\rightarrow \tau\tau$ signal events with 0--jet, 1--jet and 2--jet.
Jets are required to have $P_{T} > 30$~\GeV and $\vert \eta \vert < 4.7$ in order to count towards the jet multiplicity.

The Matrix Elements generated by MadGraph can be found in the directory \begin{verbatim}SubProcesses/internal_MadGraph_name_of_the_MatrixElement/matrixXX.f\end{verbatim} .
XX is a number chosen by Madgraph in case different Feynman diagrams contribute to the same final state.
The Feynman diagram for the process is stored in \begin{verbatim}SubProcesses/internal_MadGraph_name_of_the_MatrixElement/matrixXX.ps\end{verbatim} .
The Feynman diagram is neccessary to decide which parton distribution functions (gluon or quark flavor) we need for each Feynman diagram.


\subsubsection{Breit--Wigner terms and tau decays}

The part
\begin{equation*}
T \equiv \frac{1}{(m_{\tau}\Gamma_{\tau})^{2}} \ \delta(q^2 - m_{\tau}^2) 
  \ (2\pi)^3 \ d^3p_{\tau} \ d^3p_{h} \ d^3p_{\nu} \ \delta(E_{\tau} - E_{h} - E_{\nu}) \ \delta^3(\vec{p}_{\tau} - \vec{p}_{h} - \vec{p}_{\bar{\nu}}) \ dq^2
\end{equation*}
has identical structure for each tau.

We first perform the integration over $dq^2$ to get rid of the Breit--Wigner term. 
This yields:
\begin{equation*}
T = (2\pi)^3 \ d^3p_{\tau} \ d^3p_{h} \ d^3p_{\nu} \ \delta(E_{\tau} - E_{h} - E_{\nu}) \ \delta^3(\vec{P}_{\tau} - \vec{p}_{h} - \vec{p}_{\bar{\nu}}).
\end{equation*}
We then use the 3--dimensional $\delta$--function that represents the momentum conservation in the tau decay to perform the integration over $d^3P_{\nu}$:
\begin{equation*}
T = (2\pi)^3 d^3p_{\tau} \ d^3p_{h} \ \delta(E_{\tau} - E_{h} - E_{\nu}(\vec{p}_{\tau}, \vec{p}_{h})). 
\end{equation*}
The energy of the neutrino, $E_{\nu}$, is now a function of the momenta $\vec{p}_{\tau}$ of the tau lepton and $\vec{p}_{h}$ of the hadronic system:
$E_{\nu} = P_{\nu}^2 = (\vec{P}_{\tau} - \vec{P}_{h})^2 = P_{\tau}^2 + P_{h}^2 - 2 P_{\tau} P_{h} \cos\theta$,
where $\theta$ denotes the angle between the $\vec{p}_{\tau}$ and $\vec{p}_{h}$ vectors.
We next write the phase--space element $d^3p_{\tau}$ in polar coordinates ({\it cf.}\ section.~\ref{sec:transformation_to_polar_coordinates}).
We orient the z--axis such that it coincides with the direction of the $\vec{p}_{h}$ vector.
\begin{equation*}
T = (2\pi)^3 \ P_{\tau}^2 \ dP_{\tau} \ d\cos\theta \ d\phi \ d^3p_{h} \ \delta(E_{\tau} - E_{h} - E_{\nu}(\vec{p}_{\tau}, \vec{p}_{h})). 
\end{equation*}
We need to be careful when performing the integration over $P_{\tau}$, as the argument of the $\delta$--function depends on $P_{\tau}$.
Following the rules for $\delta$--functions~\cite{deltaFunctionRules}, $\delta(g(x)) = \sum_{i} \frac{1}{\vert g'(x_i) \vert} \delta(x - x_{i})$,
where the sum extends over all roots $x_{i}$ of the function $g(x)$, we obtain:
\begin{eqnarray}
T & = & (2\pi)^3 \ P_{\tau}^2 \ d\cos\theta \ d\phi \ d^3p_{h} \ \delta(\sqrt{P_{\tau}^2 + m_{\tau}^2} - \sqrt{P_{h}^2 + m_{h}^2} - P_{\tau}^2 - P_{h}^2 + 2 P_{\tau} P_{h} \cos\theta)) \nonumber \\
  & = & (2\pi)^3 \ d\cos\theta \ d\phi d^3p_{h} \ \left( g(x_{+}) + g(x_{-}) \right),
\label{eq:tauBlock}
\end{eqnarray}
with 
\begin{equation*}
g(x) = \frac{x}{P_{\tau}^2 + m_{\tau}^2} - \frac{P_{h} \cos\theta - x}{P_{h}^2 - 2 P_{h} x \cos\theta + x^2}.
\end{equation*}
The two roots $x_{+}$ and $x_{-}$ are given by:
\begin{equation}
x{\pm} = \frac{(m_{\tau}^2 + m_{h}^2) P_{h} \cos\theta \pm \sqrt{(P_{h}^2 + m_{h}^2) \cdot (m_{\tau}^2 - m_{h}^2)^2 - 4 m_{\tau}^2 P_{h}^2 \sin^2\theta}}{4 m_{\tau}^2 P_{h}^2 \sin^2\theta}.
\label{eq:x}
\end{equation}
The remaining integration over $\theta$ in Eq.~\ref{eq:tauBlock} extends over the region for which the expression in the radical of Eq.~\ref{eq:x} remains positive:
\begin{equation*}
(m_{\tau}^2 - m_{h}^2)^2 - 4 m_{\tau}^2 P_{h}^2 \sin^2\theta > 0 \Leftrightarrow 0 < \sin \theta < \frac{m_{\tau}^2 - m_{h}^2}{4 m_{\tau} P_{h}}.
\end{equation*}

\subsubsection{Putting it all together}

Final integration variables:
\begin{itemize}
\item $M_{\tau\tau}$
\item $x_{a}$
\item $\phi_{\tau+}$
\item $\phi_{\tau-}$
\item $P_{h+}$, for energy transfer function of first hadronic tau
\item $P_{h-}$, for energy transfer function of second hadronic tau
\item $P_{x}^{recoil}$
\item $P_{y}^{recoil}$
\end{itemize}

To--do:
\begin{itemize}
\item Perform a variable transformation from $d\theta_{1} d\theta_{2}$ to $dM_{\tau\tau}$, the mass of the tau lepton pair,
  and $u = P_{z_{1}} + P_{z_{2}}$, the sum of longitudinal momenta of the two tau leptons.
  These transformations are neccessary in order to make the integration over the Breit--Wigner term for the Higgs and the integration over $dx_{b}$ numerically stable.
\item Extend the formalism for the tau decays to $\tau \rightarrow e \nu\bar{\nu}$ and $\tau \rightarrow \mu \nu\bar{\nu}$ decays.
\item Check if (LO) $\vert \mathcal{M}_{HS} \vert^2$ obtained from MadGraph can handle finite transverse momentum of the Higgs.
  In case MadGraph requires $P_{T}^{H} = 0$, we need to replace the integration over the hadronic recoil in Eq.~\ref{eq:meSignal} by a two--dimensional $\delta$--function.
\item We need to determine the product of signal cross--section times acceptance, $\sigma_{acc}$, in Eq.~\ref{eq:meSignal}.
  Christian suggest we approximate this by the Standard Model Higgs production cross--section obtained from the LHC Higgs cross section working--group~\cite{LHCHiggsCrossSectionWorkingGroup:2011ti}
  times the signal acceptance as function of mass from the MSSM Higgs $\rightarrow \tau\tau$ analysis~\cite{CMS_AN_2013-171}.
\item We need to find--out in which format the Fortran code for $\vert \mathcal{M}_{HS} \vert^2$ generated by MadGraph expects its input.
  Code for performing the numerical integration and for calling the parton distribution functions already exist in SVfit.
\end{itemize}

For debugging:
\begin{itemize}
\item We appreciate that the matrix element formalism is not trivial and we anticipate that we may make mistakes that we need to debug.
  The idea is to compute Eq.~\ref{eq:meSignal} for a series of test Higgs masses $\{ m_{H}^{i} \}$ in simulated Higgs $\rightarrow \tau\tau$ signal events with $m_{H}^{true} = 125$~\GeV.
  We expect that for most signal events the maximum weight $w$ is attained for a test mass $m_{H}^{i}$ close to the true Higgs mass $m_{H}^{true}$,
  modulo a typical resolution of $\mathcal{O}(20\%)$ that we plan to compare with SVfit~\cite{Bianchini:2014vza}.
\end{itemize}





